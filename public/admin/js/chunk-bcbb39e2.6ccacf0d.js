(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-bcbb39e2"],{"1fd2":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{label:"房间列表",inline:!0,name:"list"}},[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.form_list}},[i("el-form-item",[i("el-input",{attrs:{placeholder:"请输入商户名称"},model:{value:e.form_list.business_name,callback:function(t){e.$set(e.form_list,"business_name",t)},expression:"form_list.business_name"}})],1),i("el-form-item",[i("el-input",{attrs:{placeholder:"请输入房间名称"},model:{value:e.form_list.room_name,callback:function(t){e.$set(e.form_list,"room_name",t)},expression:"form_list.room_name"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",round:""},on:{click:e.loadRoomListData}},[e._v("查询")])],1)],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-button",{staticStyle:{float:"right","margin-right":"20px","margin-bottom":"10px"},attrs:{size:"mini",round:""},on:{click:e.handleAddRoom}},[e._v("新增房间 ")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableRoomData,border:"",stripe:"","highlight-current-row":"","header-cell-class-name":"table-header-class"}},[i("el-table-column",{attrs:{prop:"room_id",label:"序号"}}),i("el-table-column",{attrs:{prop:"room_name",label:"房间名称"}}),i("el-table-column",{attrs:{prop:"company.company_name",label:"所属商户"}}),i("el-table-column",{attrs:{prop:"store.store_name",label:"所在店面"}}),i("el-table-column",{attrs:{prop:"seats_num",label:"配置人数"}}),i("el-table-column",{attrs:{label:"收费模式"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.billing.price)+e._s(t.row.billing.price_type)+","+e._s(t.row.billing.time_unit)+"/"+e._s(t.row.billing.time_type))])]}}])}),i("el-table-column",{attrs:{prop:"created_at",label:"创建日期"}}),i("el-table-column",{attrs:{prop:"is_use",label:"使用状态"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",round:""},on:{click:function(i){return e.handleEditRoom(t.row)}}},[e._v("编辑房间")])]}}])})],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("div",{staticClass:"pagination"},[e.paginate.total>0?i("el-pagination",{attrs:{background:"","page-sizes":e.paginate.pageSizes,"page-size":e.paginate.pageSize,layout:e.paginate.layout,total:e.paginate.total,"current-page":e.paginate.pageIndex},on:{"current-change":e.handleChangePage,"size-change":e.handleChangeSize}}):e._e()],1)])],1),i("el-dialog",{attrs:{title:e.title,"close-on-click-modal":e.closeModal,visible:e.dialogVisible,width:"600px;"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"dialog_form",attrs:{model:e.dialog_form,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"所属门店",prop:"storeArr"}},[i("el-cascader",{attrs:{placeholder:"选择所在区域",props:e.storeListData,clearable:""},on:{change:e.loadBillingData},model:{value:e.dialog_form.storeArr,callback:function(t){e.$set(e.dialog_form,"storeArr",t)},expression:"dialog_form.storeArr"}})],1),i("el-form-item",{attrs:{label:"房间名称",prop:"room_name"}},[i("el-input",{attrs:{placeholder:"请输入房间名字最长30位"},model:{value:e.dialog_form.room_name,callback:function(t){e.$set(e.dialog_form,"room_name",t)},expression:"dialog_form.room_name"}})],1),i("el-form-item",{attrs:{label:"座位数量",prop:"seats_num"}},[i("el-input",{attrs:{placeholder:"请选择设置座位数量"},model:{value:e.dialog_form.seats_num,callback:function(t){e.$set(e.dialog_form,"seats_num",e._n(t))},expression:"dialog_form.seats_num"}})],1),i("el-form-item",{attrs:{label:"板子选择",prop:"dup_id"}},[i("el-select",{attrs:{placeholder:"请选择板子"},model:{value:e.dialog_form.dup_id,callback:function(t){e.$set(e.dialog_form,"dup_id",t)},expression:"dialog_form.dup_id"}},e._l(e.boardListData,(function(e){return i("el-option",{key:e.dup_id,attrs:{label:e.board_name,value:e.dup_id}})})),1)],1),i("el-form-item",{attrs:{label:"计费模式",prop:"billing_id"}},[i("el-select",{attrs:{placeholder:"请选择计费模式"},model:{value:e.dialog_form.billing_id,callback:function(t){e.$set(e.dialog_form,"billing_id",t)},expression:"dialog_form.billing_id"}},e._l(e.billingData,(function(e){return i("el-option",{key:e.billing_id,attrs:{label:e.billing_name,value:e.billing_id}})})),1)],1),i("el-form-item",{attrs:{label:"房间描述",prop:"describe"}},[i("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入房间描述最长150字"},model:{value:e.dialog_form.describe,callback:function(t){e.$set(e.dialog_form,"describe",t)},expression:"dialog_form.describe"}})],1),i("el-form",{ref:"device_form",staticStyle:{position:"relative"},attrs:{model:e.deviceItem,rules:e.addDeviceRules,"label-width":"80px"}},[i("el-form-item",{staticStyle:{width:"20%",float:"left",position:"relative"},attrs:{prop:"seat_num",label:"座位号"}},[i("el-input",{attrs:{placeholder:"座位号"},model:{value:e.deviceItem.seat_num,callback:function(t){e.$set(e.deviceItem,"seat_num",e._n(t))},expression:"deviceItem.seat_num"}})],1),i("el-form-item",{staticStyle:{width:"30%",float:"left",position:"relative"},attrs:{prop:"device_name",label:"设备名称"}},[i("el-input",{attrs:{placeholder:"设备名称"},model:{value:e.deviceItem.device_name,callback:function(t){e.$set(e.deviceItem,"device_name",e._n(t))},expression:"deviceItem.device_name"}})],1),i("el-form-item",{staticStyle:{width:"30%",float:"left",position:"relative"},attrs:{prop:"device_id",label:"设备id"}},[i("el-input",{attrs:{placeholder:"设备id"},model:{value:e.deviceItem.device_id,callback:function(t){e.$set(e.deviceItem,"device_id",t)},expression:"deviceItem.device_id"}})],1),i("el-form-item",{staticStyle:{width:"20%",float:"left"}},[i("el-button",{attrs:{size:"mini",round:""},on:{click:function(t){return e.addDeviceItem("device_form")}}},[e._v("添加设备")])],1)],1),i("el-form-item",{staticStyle:{"margin-top":"100px"},attrs:{label:"游戏设备",prop:"devices"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dialog_form.devices,border:""}},[i("el-table-column",{attrs:{type:"index",index:e.indexMethod,label:"序号"}}),i("el-table-column",{attrs:{prop:"seat_num",label:"座位号"}}),i("el-table-column",{attrs:{prop:"device_id",label:"设备id"}}),i("el-table-column",{attrs:{prop:"device_name",label:"设备名称"}}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[i("el-button",{attrs:{size:"mini",type:"danger",round:""},on:{click:function(i){return e.removeDeviceItem(t.row)}}},[e._v("删除设备")])],1)]}}])})],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.dialogCance}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.dialogConfirm("dialog_form")}}},[e._v("确 定")])],1)],1)],1)],1)},o=[],r=(i("4de4"),i("c975"),i("d81d"),i("a434"),i("b0c0"),i("420d")),n=i("3a92"),l=i("6711"),d=i("5c96"),s={data:function(){var e=this,t=function(t,i,a){var o=i.length;if(o<1)return a(new Error("设备不能为空"));var r=e.dialog_form.seats_num+1;if(r<o)return a(new Error("设备不能超过(座位数+1)，即"+r+"个,请删除多余的设备!"));if(o>17)return a(new Error("设备不能超过17个"));if(r>o)return a(new Error("设备数还没满"+r+"个,座位数量n，必须添加n+1设备！"));var n=i.filter((function(t){return t.seat_num>e.dialog_form.seats_num}));if(n.length>0)return a(new Error("已添加的设备列表，座位号只能小于等于座位数！这种情况一般是编辑设备，删除了低位座位号设备，刷新页面重新编辑即可！"));var l=i.filter((function(e){return 0==e.seat_num}));if(1!==l.length)return a(new Error("请添加法官设备，0号位"));a()},i=function(e,t,i){return isNaN(t)?i(new Error("座位数量,必须是一个数字")):t<1||t>16?i(new Error("座位数量,取值范围1-16")):void i()},a=function(t,i,a){if(isNaN(i))return a(new Error("座位号必须是一个数字"));var o=e.dialog_form.seats_num||16;if(i<0||i>o)return a(new Error("座位号取值范围0-"+o));var r=e.dialog_form.devices.map((function(e){return e.seat_num}));if(r.indexOf(i)>-1)return a(new Error("座位号不能重复!"));a()},o=function(t,i,a){if(isNaN(i))return a(new Error("设备id必须一个数字，即短id"));if(i<1)return a(new Error("设备id只能是大于0的整数!"));var o=e.dialog_form.devices.map((function(e){return e.device_id}));if(o.indexOf(i)>-1)return a(new Error("设备id不能重复!"));a()};return{activeName:"list",tableRoomData:[],boardListData:[],closeModal:!1,paginate:{total:0,pageIndex:1,pageSize:15,pageSizes:[5,10,15,20],layout:"total, sizes, prev, pager, next, jumper"},loading:!1,form_list:{room_name:"",business_name:"",limit:10,page:1},dialogVisible:!1,billingData:[],storeListData:{lazy:!0,lazyLoad:function(e,t){e.level;var i={parent_id:e.value||-1,level:e.level||0};Object(r["b"])(i).then((function(e){t(e.data.data)})).catch((function(e){console.log(e)})).then((function(){}))}},deviceItem:{seat_num:0,device_id:"",device_name:"设备0"},dialog_form:{room_id:"",dup_id:1,room_name:"",seats_num:16,describe:"",devices:[],billing_id:"",storeArr:[0,0],delDevicesIds:[]},rules:{room_name:[{required:!0,message:"请输入房间名称最长30位",trigger:"blur"},{min:3,max:30,message:"长度在 3 到 30个字符",trigger:"blur"}],seats_num:[{validator:i,trigger:"blur"}],dup_id:[{required:!0,message:"请填选择板子",trigger:"change"}],storeArr:[{required:!0,message:"请选择门店"}],describe:[{required:!0,message:"请填输入房间描述",trigger:"blur"}],billing_id:[{required:!0,message:"请填选择计费模式",trigger:"change"}],devices:[{validator:t,trigger:"blur"}]},addDeviceRules:{seat_num:[{validator:a,trigger:"blur"}],device_id:[{validator:o,trigger:"blur"}],device_name:[{required:!0,message:"请填输入设备名称",trigger:"blur"}]}}},mounted:function(){this.loadRoomListData(),this.loadBoardList()},computed:{title:function(){return this.dialog_form.room_id?"编辑房间":"新增房间"}},methods:{handleClick:function(e,t){console.log(e.name)},loadRoomListData:function(){var e=this;Object(r["d"])(this.form_list).then((function(t){e.tableRoomData=t.data.data.data,e.loading=!1,e.paginate.total=t.data.data.total})).catch((function(e){console.log(e)})).then((function(){})),this.tableRoomData=[]},handleChangePage:function(e){this.paginate.pageIndex=e,this.form_list.page=e,this.loadRoomListData()},handleChangeSize:function(e){this.paginate.pageSize=e,this.form_list.limit=e,this.loadRoomListData()},dialogConfirm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.dialog_form.room_id?Object(r["c"])(t.dialog_form).then((function(e){t.dialogVisible=!1,t.loadRoomListData()})).catch((function(e){})).then((function(){})):Object(r["a"])(t.dialog_form).then((function(e){t.dialogVisible=!1,t.loadRoomListData()})).catch((function(e){})).then((function(){}))}))},dialogCance:function(){this.dialogVisible=!1},loadBillingData:function(e){var t=this,i=e[0],a=e[1];this.billingData=[],i&&a?Object(n["c"])({company_id:i,store_id:a}).then((function(e){t.billingData=e.data.data.data})).catch((function(e){})).then((function(){})):this.dialog_form.billing_id=""},handleEditRoom:function(e){this.dialogVisible=!0,this.dialog_form.room_id=e.room_id,this.dialog_form.room_name=e.room_name,this.dialog_form.seats_num=e.seats_num,this.dialog_form.describe=e.describe,this.dialog_form.devices=e.devices,this.dialog_form.billing_id=e.billing_id,this.dialog_form.dup_id=e.dup_id,this.dialog_form.storeArr=[e.company_id,e.store_id],this.loadBillingData([e.company_id,e.store_id])},handleAddRoom:function(){this.dialog_form.room_id=0,this.dialogVisible=!0,this.dialog_form.storeArr=[],this.dialog_form.devices=[],this.dialog_form.billing_id="",this.dialog_form.room_name="",this.dialog_form.describe="",this.billingData=[]},removeDeviceItem:function(e){var t=this.dialog_form.devices.indexOf(e);this.dialog_form.devices.splice(t,1)},addDeviceItem:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var i=t.dialog_form.devices.length,a=t.dialog_form.seats_num+1;if(i>=a)return t.showMessage("最多添加"+a+"个设备,0号位是法官，其他1-"+t.dialog_form.seats_num+"号"),!1;a>i?(t.dialog_form.devices.push({seat_num:t.deviceItem.seat_num,device_id:t.deviceItem.device_id,device_name:t.deviceItem.device_name}),t.dialog_form.devices.sort((function(e,t){return e.seat_num-t.seat_num})),t.deviceItem.seat_num+=1,t.deviceItem.device_name="设备"+t.deviceItem.seat_num):t.showMessage("座位数已满"+a)}))},indexMethod:function(e){return e+1},showMessage:function(e){Object(d["Message"])({message:e,type:"error",duration:5e3})},loadBoardList:function(){var e=this;Object(l["b"])({limit:50}).then((function(t){e.boardListData=t.data.data.data})).catch((function(e){})).then((function(){}))}}},c=s,m=i("2877"),u=Object(m["a"])(c,a,o,!1,null,null,null);t["default"]=u.exports},"3a92":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return n}));var a=i("f46b");function o(){return Object(a["a"])({url:"/room/billing/billingConfig",method:"post"})}function r(e){return Object(a["a"])({url:"/room/billing/addBilling",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/room/billing/billingList",method:"post",data:e})}},"420d":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return n})),i.d(t,"d",(function(){return l}));var a=i("f46b");function o(e){return Object(a["a"])({url:"/room/index/companyAndRoomList",method:"post",data:e})}function r(e){return Object(a["a"])({url:"/room/index/addRoom",method:"post",data:e})}function n(e){return Object(a["a"])({url:"/room/index/editRoom",method:"post",data:e})}function l(e){return Object(a["a"])({url:"/room/index/roomList",method:"post",data:e})}},6711:function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return n}));var a=i("f46b");function o(e){return Object(a["a"])({url:"game/board/boardList",method:"post",data:e})}function r(e){return Object(a["a"])({url:"game/board/editBoard",method:"post",data:e})}function n(e){return Object(a["a"])({url:"game/board/addBoard",method:"post",data:e})}},a434:function(e,t,i){"use strict";var a=i("23e7"),o=i("23cb"),r=i("a691"),n=i("50c4"),l=i("7b0b"),d=i("65f0"),s=i("8418"),c=i("1dde"),m=i("ae40"),u=c("splice"),f=m("splice",{ACCESSORS:!0,0:0,1:2}),_=Math.max,g=Math.min,p=9007199254740991,b="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!u||!f},{splice:function(e,t){var i,a,c,m,u,f,h=l(this),v=n(h.length),w=o(e,v),x=arguments.length;if(0===x?i=a=0:1===x?(i=0,a=v-w):(i=x-2,a=g(_(r(t),0),v-w)),v+i-a>p)throw TypeError(b);for(c=d(h,a),m=0;m<a;m++)u=w+m,u in h&&s(c,m,h[u]);if(c.length=a,i<a){for(m=w;m<v-a;m++)u=m+a,f=m+i,u in h?h[f]=h[u]:delete h[f];for(m=v;m>v-a+i;m--)delete h[m-1]}else if(i>a)for(m=v-a;m>w;m--)u=m+a-1,f=m+i-1,u in h?h[f]=h[u]:delete h[f];for(m=0;m<i;m++)h[m+w]=arguments[m+2];return h.length=v-a+i,c}})},d81d:function(e,t,i){"use strict";var a=i("23e7"),o=i("b727").map,r=i("1dde"),n=i("ae40"),l=r("map"),d=n("map");a({target:"Array",proto:!0,forced:!l||!d},{map:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-bcbb39e2.6ccacf0d.js.map